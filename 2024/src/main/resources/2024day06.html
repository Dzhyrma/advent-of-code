<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trail Visualization with Steps</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        table {
            border-collapse: collapse;
            margin: 20px auto;
        }
        td {
            width: 12px;
            height: 12px;
            text-align: center;
            vertical-align: middle;
            border: 1px solid #ccc;
            font-family: Arial, sans-serif;
            font-size: 10px;
        }
        .trailhead {
            font-weight: bold;
            background-color: lightblue;
        }
        .reachable {
            background-color: #990000;
        }
        .exploring0 {
            background-color: #FF9999;
        }
        .exploring1 {
            background-color: #FF8888;
        }
        .exploring2 {
            background-color: #FF7777;
        }
        .exploring3 {
            background-color: #FF6666;
        }
        .exploring4 {
            background-color: #FF5555;
        }
        .exploring5 {
            background-color: #FF4444;
        }
        .exploring6 {
            background-color: #FF3333;
        }
        .exploring7 {
            background-color: #FF2222;
        }
        .exploring8 {
            background-color: #FF1111;
        }
        .visited {
            background-color: lightgray;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    // Topographic map as input
    const mapData = [
        "212345410210987621217890789890121034565442100125671056710",
        "200176761223670130306721698761210125471233693234982567891",
        "129289872334543245405432547654300276980344780126783456432",
        "038378969455698236912301238963211080187655693210695432569",
        "347432358766780147872898347876102391995040544589543521278",
        "456521243765469056321783210985989452876121235674512670569",
        "569010342894378765430654781234676543105431230123601789432",
        "878765401345219878345101698104569689298760345678765698901",
        "987871211216706789236782567665438776387654876659834217876",
        "856980100301893472121893432674321065410148987789323109845",
        "341213221298742345090898321789812764321039845654010256730",
        "210304378345651016782127100698903854523128734503765340321",
        "305445469098578727890036234567814923014509658712894321434",
        "416996954107689656781245898410345017877612549603401234323",
        "787887873256210545672012367321276676968233438556510965412",
        "696788980341011234543032456210987589859142123467656876701",
        "012697891232567849432141045108765412348054010198987655832",
        "763546321063458938543256036789012309878767198767810765910",
        "854435417654367867600167127678101210769898185656521894321",
        "945421308743216543214328998543232125658121034343433443212",
        "836710769034202398765011056760187034341030128765012534301",
        "327897854123101450127652347891298743210345689434547643212",
        "010898943030210763238943219782345646556776776521898756101",
        "898701034321347894567652308763201237649889889430189657810",
        "787652122134956238765641207454100348532794324321054346921",
        "896343043045840149454100012389019659431245010198761234430",
        "743214104556729450363267823478328760120356521082120123445",
        "125905234676518761278954954565405892102347436781034016596",
        "034876546787609687634543069676216743401958945698765407687",
        "345954434894514598527652178985345434567867010789896328778",
        "216763320123223423418701201234987101109798123478787819669",
        "307812018983123010509010110125676432238787234567698904550",
        "898900867654004327696327898006512343445676543234367803341",
        "714321978103215018987436567217009854232785450145236512232",
        "105497869289346787676503454398123767101090367096145210103",
        "216786454376549894521012345687634998256981278987054334565",
        "323445210865034743432301478710545877347801209678981021076",
        "434134348992125623245696589329014566467874314567832987985",
        "985012349887610014132787103458123487216965423050013456234",
        "876123456766521165001696212367870198103876302141123442112",
        "765034300125433674300105123798965287212963218932033230003",
        "052343212334894789212234037897234378733454367898144101894",
        "141256103456763210698210548782110569123765454727655432785",
        "230987232345854324782345699654023457014894325410766745696",
        "678796341078983105691056789503432128985601216321899874587",
        "569569478876803234528945093412351012676876307839782103091",
        "454478569945012343217854112328945401068985410988789232110",
        "123387654035219445306543201007876312345698523421654378901",
        "003298743124308556789801123216981235430785654530565467432",
        "210109632265467643007652014567800896521238703691454876543",
        "341234501256787632118743112310712987450349812782363989692",
        "478981987123895678729652105425673456100456701432672176781",
        "569210896054396569434501876734980143291456012341089065760",
        "354321345465787454303410969803965234582387345456543254854",
        "210983230376610341212823457812874345673296216967632103923",
        "123672121287523200123981046922123216780125407878921212310",
        "034561012898430112345672345451034301691012398761010123421",
    ];

    const numRows = mapData.length;
    const numCols = mapData[0].length;

    const getHeight = (row, col) => parseInt(mapData[row][col]);

    const container = d3.select("#map");
    const table = container.append("table");

    const cells = [];
    mapData.forEach((row, rowIndex) => {
        const tr = table.append("tr");
        const rowCells = [];
        row.split("").forEach((cell, _) => {
            const td = tr.append("td").text(cell);
            rowCells.push(td);
        });
        cells.push(rowCells);
    });

    // Mark a cell with a specific class
    const markCell = (row, col, className) => {
        if (row >= 0 && row < numRows && col >= 0 && col < numCols) {
            cells[row][col].classed(className, true);
        }
    };

    // Recursive BFS to find reachable '9's with visualization
    const bfs = async (row, col, targetHeight, visited) => {
        if (
            row < 0 || row >= numRows ||
            col < 0 || col >= numCols ||
            visited.has({ row: row, col: col }) ||
            getHeight(row, col) !== targetHeight
        ) {
            return [];
        }

        visited.add({ row: row, col: col });

        await new Promise(resolve => setTimeout(resolve, 10));

        const result = getHeight(row, col) === 9 ? [[row, col]] : [];
        if (result.length > 0) {
            markCell(row, col, "reachable");
        } else {
            markCell(row, col, `exploring${targetHeight}`);
        }

        const nextHeight = targetHeight + 1;

        // Explore neighbors
        const neighbors = [
            ...await bfs(row - 1, col, nextHeight, visited), // up
            ...await bfs(row + 1, col, nextHeight, visited), // down
            ...await bfs(row, col - 1, nextHeight, visited), // left
            ...await bfs(row, col + 1, nextHeight, visited)  // right
        ];

        return result.concat(neighbors);
    };

    // Find all trailheads and visualize trails
    const visualize = async () => {
        for (let row = 0; row < numRows; row++) {
            for (let col = 0; col < numCols; col++) {
                if (getHeight(row, col) === 0) {
                    const visited = new Set();
                    markCell(row, col, "trailhead");
                    await bfs(row, col, 0, visited);
                    visited.forEach( obj => {
                        if (getHeight(obj.row, obj.col) !== 9) {
                            cells[obj.row][obj.col].attr('class', '');
                        }
                    });
                }
            }
        }
    };

    // Start visualization
    visualize();
</script>
</body>
</html>